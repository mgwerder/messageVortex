%!TeX program=pdflatex
%!TeX encoding=utf8
%!TeX spellcheck = en_US
%!TeX root = ../../messageVortex.tex


% ********************************************************************************************************
% *** Decisions and Research
% ********************************************************************************************************
\part{The  MessageVortex System}

In the following section we describe the core functionalities of the MessageVortex system. We start off with the general thread model. We then collect requirements for an anonymisation system. Next would be a rationale for single system features.

In the core chapter of this part we describe the MessageVortex protool and its key techniques.

\chapter{Introduction}
MessageVortex is a protocol piggybacking common transport protocols somehow similar as S/MIME\cite{RFC2015} or PGP\cite{PGP} piggybacks common transport protocols such as SMTP. 

Unlike these protocols we need the capability to keep our messages secret. MessageVortex itself is agnostic to the transport, but we do require apprpriate blending to hide into the transport layer. The message itself should be only visible to a single processing node. Information destined for other nodes should not be visible and the information processed on a node should not leak any information about a message. This applies to the message itself as well as to the metainformation beloning to a message.

We therefore crafted all operations very carefully to keep as much information secet as we could.

\chapter{Requirements for an Anonymizing Protocol\label{sec:genRequirements}}
In the following sections, we elaborate on the main characteristics of the anonymizing protocol. 

The primary goal of the protocol is to enable Freedom of speech, as defined in Article 19 of the International Covenant on Civil and Political Rights (ICCPR)\cite{iccpr}.
\begin{quote}
	everyone shall have the right to hold opinions without interference 
\end{quote}
and
\begin{quote}
	Everyone shall have the right to freedom of expression; this right shall include freedom to seek, receive and impart information and ideas of all kinds, regardless of frontiers, either orally, in writing or print, in the form of art, or through any other media of his choice.
\end{quote}

We imply that not all participants on the Internet share this value. As of September \th{1}, 2016 Countries such as China (signatory), Cuba (signatory), Qatar, Saudi Arabia, Singapore, United Arab Emirates, or Myanmar did not ratify the ICCPR. Other countries such as the United States or Russia did either put local laws in place superseding the ICCPR or made reservations rendering parts of it ineffective. We may, therefore, safely assume that freedom of speech is not given on the Internet, as at least countries explicitly supersede them.

Network packets may pass through any point of the world. A sender has no control over it. This lack of control is since every routing device decides on its own for the next hop. This decision may be based on static rules or influenced by third party nodes or circumstances (e.g., BGB, RIP, OSPF\ldots). It is furthermore not possible to detect what way has a packet taken. The standard network diagnostic tool \verb|tracert| respectively \verb|traceroute| returns a potential list of hops. This list is only correct under certain circumstances (e.g., a stable route for multiple packets or same routing decisions regardless of other properties than the source and destination address). Any Output of these tools may, therefore, not taken as a log of routing decisions. There is no possibility in standard IP routed networks to foresee a route for a packet, nor can it be measured, recorded, or predicted before, while, or after sending. 

As an example of the problems analyzing a packet route, we may look at \verb|traceroute|. According to the man page of traceroute, \verb|traceroute| uses UDP, TCP, or ICMP packets with a short TTL and analyses the IP of the peer sending a TIME\_EXCEEDED (message of the ICMP protocol). This information is then collected and shown as a route. This route may be completely wrong. The man page describes some of the possible causes.

We cannot state that data packets we are sending are passing only through countries accepting the ICCPR to the full extent, nor can we craft packages following such a rule.

\begin{figure}[H]
	\begin{lstlisting}[language=bash,breaklines=true,basicstyle=\tiny]
	$ traceroute www.ietf.org
	traceroute to www.ietf.org.cdn.cloudflare-dnssec.net (104.20.0.85), 64 hops max
	1   147.86.8.253  0.418ms  0.593ms  0.421ms
	2   10.19.0.253  1.177ms  0.829ms  0.782ms
	3   10.19.0.253  0.620ms  0.427ms  0.402ms
	4   193.73.125.35  1.121ms  0.828ms  0.905ms
	5   193.73.125.81  2.991ms  2.450ms  2.414ms
	6   193.73.125.81  2.264ms  1.961ms  1.959ms
	7   192.43.192.196  6.472ms  199.543ms  201.152ms
	8   130.59.37.105  3.465ms  3.138ms  3.121ms
	9   130.59.36.34  3.904ms  3.897ms  4.989ms
	10   130.59.38.110  3.625ms  3.333ms  3.379ms
	11   130.59.36.93  7.518ms  7.232ms  7.246ms
	12   130.59.38.82  7.155ms  17.166ms  7.034ms
	13   80.249.211.140  22.749ms  22.415ms  22.467ms
	14   104.20.0.85  22.398ms  22.222ms  22.146ms
	\end{lstlisting}
	\caption{A traceroute to the host www.ietf.org}
\end{figure}

To enable freedom of speech, we need a mean of transport for messages which keep sender and recipient anonymous to an adversary.

We start first by defining a thread model and then collect some basic requirements. These requirements are deduced from the threat and from lessons learned from common attacks to anonymity systems as outlined in \ref{sec:attacks}.

\section{Threat model\label{sec:adversary}}
We refer to jurisdiction as a geographical area where a set of legal rules created by a single actor or a group of actors apply, which contains executive capabilities (e.g., police, army, or secret service) to enforce this set of legal rules.

We assume for our protocol that adversaries are state-sponsored actors or players of large organizations. These actors have high funding and expected to have elaborated capabilities themselves or within reach of the sponsor. Actors may join forces with other actors as allies. However, achieving more than 50\% on a world scale is excluded from our model. We always assume one or more actors with disjoint interests covering half of the network or more. 

We assume the following goals for an adversary:
\begin{itemize}
	\item An adversary may want to disrupt non-authorized communication.
	\item An adversary may want to read any information passing through portions of the Internet.
	\item An adversary may want to build and conserve information about individuals or groups of individuals of any aspect of their life. 
\end{itemize}

To achieve these goals, we assume the following properties of our adversary:
\begin{itemize}
	\item An adversary has elaborated technical know-how to attack any infrastructure. This attack may cover any attack favoring his goals, starting with exploiting weaknesses of popular software (e.g., buffer overflows or zero-day exploits) down to simple or elaborated (D)DoS attacks.
	\item An adversary may monitor traffic at any point in public networks within a jurisdiction.
	\item An adversary may modify routing information within a jurisdiction freely.
	\item An adversary may freely modify even cryptographically weak secured data where a single or a limited number of entities grant proof of authenticity or privacy.
	\item An adversary may inject or modify any data on the network of a jurisdiction.
	\item An adversary may create their nodes in a network. He may furthermore monitor their behavior and data flow without limitation.
	\item An adversary may force a limited number of other non-allied nodes to expose their data to him. For this assumption, we explicitly excluded actors with disjoint interests.
	\item An adversary may have similar access to resources as within its jurisdiction in a limited number of other jurisdictions.
\end{itemize}

we may furthermore subdivide the adversaries into the following sub-classes:
\begin{itemize}
	\item A censoring adversary\\
	The primary goal of this adversary is censoring messages and opinions, not within his interests. He does this, regardless of whether the activities of censorship may be observed or not. Therefore, this adversary does not necessarily cloak its activities and typically bans censorship circumventing activities as illegal.
	\item An observing adversary\\
	This adversary behaves like a traditional spy. He collects and classifies information while typically hiding its activities. Unlike within reach of a censoring adversary, in this case, typically, no restrictions apply to the use of anonymization technology.
\end{itemize}

\section{Required Properties of an Unobservable network}
In this section, we summarize the required properties of an anonymizing system.

\subsection{Anonymizing and Unlinking}
As we are unable to limit the route of our packets through named jurisdictions, we must protect ourselves from unintentionally breaking the law of a foreign country. Therefore, we need to be anonymous when sending or receiving messages. Unfortunately, most transport protocols (in fact, almost all of them such as \defref{SMTP}, SMS, \defref{XMPP}, or IP) use a globally unique identifier for senders and receivers, which are readable by any party which is capable of reading the packets. 

As a result, the anonymization of a sender or a receiver is not simple. A relay may allow at least the anonymization of the original sender given trust into the proxy. By combining it with encryption, we may even achieve a simple form of a sender and receiver pseudonymity. If cascading more relay like infrastructures and combining it with cryptography, we may achieve sender and receiver anonymity. When introducing anonymous remailing endpoints, we may additionally achieve both simultaneously.

These are the standard approaches in remailers and mixes. Their approaches are questionable as shown in \ref{sec:remailer} and \ref{sec:mixnets}. We have seen attacks on such systems in the past. Some of them were successful.

\subsection{Censorship Resistant}
In our scenario in \ref{sec:genRequirements}, we defined the adversary as someone with superior access to the network and its infrastructure. Such an adversary might attack a message flow in several ways:
\begin{itemize}
	\item Identify sender.
	\item Identify recipient.
	\item Identify other involved parties.
	\item Read messages passed or extract meta information.
	\item Disrupt communication fully or partially. This may or may not include the possible identification of the traffic.
\end{itemize}

We furthermore have to assume that all actions taken by a potential adversary are not subject to legal prosecution. This assumption based on the fact that an adversary trying to establish censorship may be part of the government of jurisdiction. We may safely assume that there are legal exceptions in some jurisdictions for such entities.

To be able to withstand an adversary outlined above, the messages sent requires to be unidentifiable by attributes or content. ``Attributes'' include any meta information including, but not limited to, frequency, timing, message size, sender, protocol, ports, or recipient.

\subsection{Controllable trust}
We have multiple options for relying on trust when building our system. We may rely on trust in infrastructure, we may work with distrust in infrastructure. In our model, we will work with distrust into the infrastructure. As every infrastructure node learns from each transaction (e.g., the usage of the network or size of messages), we have to minimize or ideally eradicate such information gains. A main problem is that we are unable to hide peer senders or recipients when routing messages. In jurisdictions where such infrastructure usage is illegal, we need to hide the presence of our routing messages from any party not trusted. Such hiding concludes that we need to be able to control which nodes are involved when sending messages. We refer to this concept as controllable trust.

In terms of trust, we have to conclude that:
\begin{enumerate}
	\item We trust in infrastructure because it is under full control of either the sender or the recipient. If we are unable to trust these infrastructures information may be leaked without any problems. So trusting these infrastructures is inevitable.
	\item We should not trust all other infrastructure as an adversary is potentially able to misuse data passed through it.
\end{enumerate}

\subsection{Reliable}
Any message-sending protocol needs to be reliable in its functionality. If the means of message transport are unreliable, users tend to use different means for communication\cite{zhou2011examining}. 

\subsection{Diagnoseable}
Transparent behavior is a prerequisite for reliability. If something is generating a  behavior, but we are unable to determine the reason for it (i.e., if we are expecting a different behavior), we usually assume a malfunction. Therefore ``reliable'' means not only stable by its behavior. It also means diagnoseable. A user's perception will not be ``reliable'' if he is not able to determine causes for differences in observed and expected behavior (e.g., \cite{nicholson2003assessing}).

\subsection{Available}
Availability has two meanings in this context, which do differ. Technology is available if\ldots
\begin{enumerate}
	\item a sender and a recipient have (or may have) the means of using it.
	\item the infrastructure provides the service (as opposed to: ``is running in a degraded or faulty state and, therefore, unable to provide the service'').
\end{enumerate}

The first meaning tells us that a protocol must run on infrastructure on which the user has access to it.

The second meaning tells us that messages must always be capable of flowing from the sender to the recipient. As a part of the infrastructure may fail at any time, the protocol must offer the possibility to send messages through alternate routes. Alternative routes are simple to achieve, and many protocols implement such redundancies already. However, taking into account that the sender and recipient are not known to a routing node, this is a goal hard to achieve. If we leave the choice of routing to any node apart from a trusted node, we will enable untrusted nodes to manipulate routing decisions and thus affect the security of a message.

\subsection{Identifiable Sender}
A messaging system offering unlinkability may offer sender anonymity. If so, a sender should be identifiable in such a way, that a classification of senders is possible at any time, and impersonation is not achievable. It is important to understand that an identifiable sender does not necessarily mean that we can identify a sender as a specific party. In our case, any identification will do, which offers non-hijackable pseudonymity. We decided to go for a short-lived pseudonymity (see \defref{eID} in section \ref{sec:ephemeralIdentity}). This system guarantees that while only a pseudonym of the sender is known, the hijacking of data by other participants of the system is not possible.

\section{Summary}
The following key requirements were identified in the previous section:
\begin{itemize}
	\item The System should be allow an adversary as defined in out threat model to identify a participating node 
	\item The System should unlinking senders and recipients towards an adversary.
	\item The system should be censorship resistant
	\item Decisions regarding the security of a message must be under the full control of a sending or receiving party.
	\item The system should be reliable
	\item The system should be diagnoseable 
	\item Anonymization service is available any time and to anyone
	\item Anonymization may be used any time
	\item The sender and its message may be authenticated by the recipient
\end{itemize}

Implicitly, the system should not expose any members to additional threats. This is a logic consequence already covered in the censorship resitance requirement. Same applies to the fact that the system should be easy to use. A complex system would exclude members with missing knowledge or education. 

\chapter{Rationale}
In this chapter we set course for our protocol. We explain why the protocol has already some technologies and approaches preset before even starting the description of the protocol.

\section{Detectable properties of an Anonymization System}
\subsection{Transmission Type}
If we want to be censorship resistant then we need to be undetectable, as any possible detection or identification enables an adversary to filter or disrupt these messages from a network. We also have to start off with our protocol at a very low level. It is not sensible to create a new transport protocol. Such a specific transport protocol would enable an adversary censorship. Either by identifying the protocol or its properties. We could use side channel transmission (such as timing of messages) instead of an own protocol. This, however, would imply a proprietary infrastructure on the internet which would either record or extract such side channels or even sends them. As proprietary infrastructure allows an adversary to put pressure such as legal threats on an owner of such infrastructure. We therefore chose an approach which is not relying on proprietary infrastructure within the internet.

\subsection{Required Infrastructure}
As previously mentioned the protocol should not rely on proprietary infrastructure. This leaves us either to a P2P approach or we may use already existing infrastructure for our purpose. P2P protocols are in the current internet a niche approach compared to infrastructure bound services. To be better able to hide in a mass, we have chosen to go with the infrastructure approach.

This automatically results in a piggybacking protocol on a common internet protocol. The protocol should be common and blocking it should have significant unwanted impact to an adversary. The common usage of the transport protocol should enable to hide within the sheer mass of the common messages and should keep an adversary from blocking the protocol due to the reated economic impacts such a blocking would have.

Looking at the infrastructure required by the enduser, we have to state that the system should run with common hardware such as personal computers, tablets and notebooks. For obious reasons a network conectivity to the internet is a must.

\subsection{Message Size of An Anonymizing System}
When sending messages across a network they may be tracked either by the message themselfes or their attributes. This has been  a considerable weaknes  for many protocols. Attributes, such as strictly decreasing or increasing sizes allow assumption of message flows. As the most robust solution so far have either eratically behaving systems proven or system with a constant message size. The constant message size has, however, an additional downside as it may allow to identify messages by assuming that their size is always related to the fixed message size. We therefore will go with an eratically behaving system without restricting the size of any component if possible.

\subsection{Message Timing of an Annonymisation System}
Timing of messages may leak several properties. First of all, bound to a specified timeframe may be related to each other. Therefore only a protocol without restrictions regarding the timing of a message. This however has some drawbacks. Not aplying a timing restriction realistically defies the possibility of synchnous or near synchronous message transmission. This leaves only asynchronous message transmission as the only option.

Such asynchronous behavior requires therefore that messages are stored on nodes for a specified time. Such storing has several drawbacks. Storage should be managed and kept within very small bounds to allow a large user base. Secondly such a storage requires some kind of protection to refrain users from hijacking messages destined to other users.

\section{Relying on Possibly Unsafe System and Research Results}
As all systems and algorithms applied to the system may be weakenened or fail a system needs to have the possibility to choose from multiple algorithms, protocols and infrastructures. This choice should be made by trustworthy system which restricts us to either the sender or the receiving system.

\section{Leaking of Information to Involved Parties}
As we put distrust all parties except sender and recipient routing a message should leak no information related to the message. This property is very hard to achieve and limits to very few choices and some may even be unachivable. First we have to apply routing in such a way that a processing node does not learn any information valuable to it. As we are already bound to piggybacking common transport protocols we therefore always leak the transport addresses of our transport protocols. This is a serious flaw already in the system which we are unable to mitigate with the chosen approach. A possibility would be a common internet protocol based on broadcast routing. Unfortunately except very rare protocols such as the Automated Packet Reporting System (APRS) this is not a common behavior as brodcast based systems are typically inefficient and, thus, not suitable for a huge user set.

Special care should be applied to things such as mimic routes. Mimic routes are typically generated by a node. Unlike an outside observer a routing node is typically aware over which channels mimic or decoy traffic is sent and over which channels message flow is applied. To refrain a routing nod from using such knowledge we need to apply routing operations which do not allow a rrouting node to differentiate decoy traffic from message traffic. This applies even to the case where decoy traffic is generated on the node itself. The result of a routing operations should always have the properties which do not leak additional information to any untrusted node. 

We have taken great care to achieve this goal. All of our operations result in an encrypted block which may have any size. While applying a block ciphre to a message always results in a padded message of a block size. The shanon entropy is $\approx 7.2$ as with all encrypted blocks. If applied a split or merge operation any size of the message is achievable. Any operation has an inverse operation which means that any operation may be undone at a later stage. Furthermore, any inverse operation should result in a block with the same properties, not leaking the sucess of an applied operation. To generate decoy traffic we have applied a novel type of operation. Instead of generating decoy traffic explicitely, we allow a routing node to add and remove redundancy information to a given message. By doing so it is not clear, what part of the generated data is related to the message and what part is related to decoy messages. Furthermore, we may implement true redundancy in the message paths without duplicating message content.

\section{Chosen Approaches for MessageVortex}
In this chapter we have taken the following decisions:
\begin{itemize}
	\item Have no strict message size and avoid strictly increasing or decreasing sizes in any type of message or message part.
	\item Piggybacks common protocols.
	\item Does not require specialized hardware within the internet.
	\item No proprietary systems on the internet.
	\item Runs on comodity hardware.
	\item Sends messages in an asynchronous mode.
	\item Does not enforce specific attributes such as transport protocol, message size, message timing, or providers.
	\item Run special routing operations instead of traditional mixing and recombination methodes.
	\item Offer a choice of algorithms to use when routing.
\end{itemize}


\chapter{Protocol}
\fxwarning{complete section}
\section{Key Components}
\fxwarning{complete section}
\subsection{Nodes and their identities}
\fxwarning{complete section}
\subsection{Protocol Layers}
\fxwarning{complete section}
\subsection{Vortex Messages}
\fxwarning{complete section}
\subsection{Workspaces and Ephemeral Identities}
\fxwarning{complete section}
\subsection{Routing Operations}
\fxwarning{complete section}
\section{Routing}
\fxwarning{complete section}



\section{Transport Layer and Message Blending}
\fxwarning{complete section}
\subsection{Plain Blending}
\fxwarning{complete section}
\subsection{F5 Blending}
\fxwarning{complete section}

\section{Message Structure}
\fxwarning{complete section}
\subsection{Identification of a Message}
\fxwarning{complete section}
\subsection{Message Structure Related to Censorship Circumvention}
\fxwarning{complete section}
\subsection{Message Structure Related to Information Leaking}
\fxwarning{complete section}

