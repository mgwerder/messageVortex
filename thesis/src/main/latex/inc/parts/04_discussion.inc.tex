%!TeX program=pdflatex
%!TeX encoding=utf8
%!TeX spellcheck = en_GB
%!TeX root = ../../messageVortex.tex

\part{Discussion \label{sec:discussion}}
In the following capters we analyze the protocol throughly for fitness of purpose. 

We first apply a statical analysis of the protocol to identify all informations leaked at all levels.

Then we apply a dynamic analysis of the protocol to identify all meta informations leaked during transmission of the protocol.
We distinguish between passive and active adversaries. Passive adversaries follow the MessageVortex protocol, have unlimited observation capabilities on the network up to layer 4 of the ISO/OSI protocol, and do have unlimmited observation capabilities on the transporting layer of MessageVortex. Active adversary share the capabilities of passive adversaries, but do not follow the MessageVortex protocol. Both adversaries try to obtain valuable information (e.g., message content, metadata such as the communicating peers or message frequencies).\fxwarning{ refer to adversary model}

When analyzing the goals we focus 

We then sum up the achieved goals by looking at well known attacks and analyze the effectiveness of them to analyze the protocol.

\chapter{Static analysis}
In this section we analyze statically the protocol. Looking at a full message we get the protocol outline as shown in \eqref{eq:vortexMessage} on page~\pageref{eq:vortexMessage}.

\begin{figure*}[!h]
	\begin{align}
VortexMessage                = &\langle \mathbf{MP}^{K^{-1}_{hostN}}, \langle\mathbf{PAD}, \mathbf{CP}^{K^{-1}_{hostN}}, \mathbf{H}^{K_{senderN}}, E^{K^{-1}_{senderN}}\left(H\left(\mathbf{HEADER}\right)\right)  \nonumber \\
                               & \left[\mathbf{R}^{K_{senderN}}\right], \left[\mathbf{PL}\right]*\rangle^{K_{peerN}} \rangle\label{eq:vortexMessage}\\ 
\mathbf{MP}^{K^{-1}_{hostN}}  = &E^{K^{-1}_{hostN}}\left(\mathbf{PREFIX}\langle K_{peerN}\rangle \right)\\ 
\mathbf{PAD}                 = &\langle \text{32 padding bytes from payload} \rangle\\ 
\mathbf{CP}^{K^{-1}_{hostN}} = &E^{K^{-1}_{hostN}}\left(\mathbf{CPREFIX}\langle K_{senderN}\rangle \right)\\ 
\mathbf{H}^{K_{senderN}}     = &E^{K_{senderN}}\left(\mathbf{HEADER}\right)\\  
\mathbf{HEADER} 		     = &\langle K^{1}_{senderN}, serial, maxReplays, validity, [requests, requestRoutingBlock],\nonumber\\ 
                               & [puzzleIdentifier, proofOfWork] \rangle \\  
\mathbf{R}^{K_{senderN}}     = & E^{K_{senderN}}\left(\mathbf{ROUTING}\right)\\ 
\mathbf{ROUTING}		     = & \langle [ \mathbf{ROUTINGCOMBO} ] *, forwardSecret, replyBlock \rangle\\  
\mathbf{ROUTINGCOMBO}        = & \langle processIntervall, K_{peerN+1}, recipient, \mathbf{nextCP}, \mathbf{nextMP}, \nonumber \\
                               & \mathbf{nextHEADER}, \mathbf{nextROUTING}, assemblyInstructions, id \rangle\\
\mathbf{PL}                  = &\langle \text{payload octets} \rangle *\\ 
	\end{align}
	\captionsetup{labelformat=empty}
	\caption{Detailed representation of a VortexMessage}
\end{figure*}

\section{Transport and Blending Layer}

\subsection{Identifying a Vortex Message Endpoint}
Depending on the blending method, single messages might be identified as long as they are detectable. Detectability depends on various factors such as:

\begin{itemize}
	\item Broken internal file structure (due to plain blending)
	\item Uncommon high entropy in a structureless file
	\item Unrelated message flow (see \cite{oakland2013-parrot})
	\item Non-human behaviour on the transport layer (e.g., message traffic 24x7)
\end{itemize}

If an endpoint is successfully identified then all directly related endpoints of the same protocol may be identified as well by following the message flow. This does however not enable an adversary to inject messages as the host key is not leaked. 

Assuming a global observer as an adversary and unencrypted traffic, he might discover the originating routing layer and thus identifying it as a Vortex node by following traces of the transport layer.

\section{Senders routing layer}
\fxfatal{A sender may have some knowledge about the Routing block size and may therefore guess the complexity of the routing path}

\section{Intermediate node routing layer}
\fxfatal{An intermediate node does know all the operations applied and the immediate next hop. It does learn an endpoint but is unable to use this endpoint.}
\fxfatal{An intermediate node may determine the relative message size.}

\section{Receivers routing layer}

\chapter{Dynamic analysis}
In the dynamic Analysis we reach out to an active adversary. An active adversary modifies traffic in a non protocol conformant way, or missuses available or obtained information to disrupt messages, nodes, or the system as a whole.

\section{Attacks against the vortex system itself}
An active adversary may attack the transport layer. Most of the transport layer are not able to reject message flooding. Therefore, it is easy to attack a transport layer with a flooding attack, such as a distributed denial of service (DDoS) attack. Due to the nature of the protocol we are unable to apply additional protection on the transport layer or below. The Vortex Message format itself is however crafted in such a way that only minimal effort is sufficient to get the involved parties of a transmission. The Operations $ K_{msgN}=D^{K^{1}_{host}}\left(P\right)$ and $HEADER=D^{K_{msgN}}\left(H\right)$ are sufficient to identify message senders. Unknown Senders may be discarded without further processing. Known senders may be identified as legitimate and processed further. Known identities misbehaving and message duplicates may be discarded. 


\subsection{DoS Attacks against the System}
An active adversary may not follow the protocol and modify any parts of the message. The following paragraphs reflect different kinds of behaviour and how they affect the messages and the system as a whole.

An adversary may not follow the blending specification. If he uses a specification which is less secure an independent third party observer may follow traffic. This is not sensible as such a node may send all the knowledge to such a collaborating node directly. In the case of a  target node not supporting the chosen blending method, the partial message path becomes interrupted. A possible redundancy in the path may recover the message from such a case.

\subsubsection{Traffic Replay}
Traffic replay is a common way to highlight traffic in many systems by replaying the same traffic and increase the signal to noise ratio of a system. 

Due to the replay protection of the vortex protocol this is not possible. Any traffic generated by an attacking node is already known. Any subsequent messages of other nodes are only generated once even if a message is repeatedly received.

\subsection{Diagnosability of traffic}

\subsubsection{Hijacking of Header and Routing Blocks}
An attacker might try to recombine a header block of a third entity with a routing block crafted to get workspace content of a foreign node. To protect against this scenario every routing block and its corresponding header block have a common value called forward secret. As the content of a hijacked header block is not known he is unable to guess the forward secret within the block.

To bruteforce the value is not possible due to the replay protection. More precisely, the probability for hijacking a single identity block is $\frac{1}{2^{32}}$. If taking into account that a routing block may be replayed to the absolute maximum probability rises to $\frac{2^8-1}{2^{32}}\approx\frac{1}{2^{24}}$. Hijacking such a block allows onetime access to the working space and is visible to the owner due to the manipulated quotas. Failing of an attack will result in exhausting the ephemeral identities quotas and a new unlinked ephemeral identity will be created. 
 

\subsubsection{Partial Implicit Routing Diagnosis}
We are able to create data which is routed back to or through the original sending node. This traffic is well defined and may be used to certify that the loop processing the message is working as expected. By combining the messages and sending intermediate results through multiple paths it is even possible to extract the substatus of some loops and combine the result within transfer into a single message.

As a special case, implicit routing diagnostic may be used to diagnose the full route by taking specific excerpts from a message and routing them from the recipient back to the sender. 

\subsubsection{Partial Explicit Routing Diagnosis}
If a message fails to deliver according to implicity routing diagnosis, additional messages may be sent to pick up content of the workspace of ephemeral identities throughout the path. These messages are due to the only binding to the ephemeral identity not distinguishable from the original messages. Assuming that a node always behaves either according or not according to the rules of the system, a node may be identified.

\subsubsection{Denial of Service by Exhausting Quotas or Limits}
A malicious node may try to exhaust quotas or limits. As we do trust in sender and recipient, all other nodes have no knowledge about the forward secrets used in the message. The options for an adversary are then as follows:

\begin{itemize}
	\item Resend a MURB (with different content) as often as possible to exhaust message and transfer quota.
	\item Create intentionally huge, incorrect message content to exhaust transfer quota.
\end{itemize}

\subsubsection{Traffic Highlighting}
Traffic caused by a routing block may be observed by to a certain extent on a statistical base. A node may generate bad message content of exceptionally large or small nature this might potentionally highlight messages involved in message routing using no split or relative split operations as well as addRedundancy operations.

\section{Achieved Anonymity and Flaws}
\subsection{Measuring Anonymity}
It is very hard to measure anonymity as it involves many uncontrollable factors. We may however control the degree of anonymity according to the number of involved parties. Assuming a sender knows the complete message path including all operations carried out on any untrusted node a message travels through, the anonymity is maxed to  the number of involved nodes $n$ excluding the sender nodes. This degree of $n-1$ may be further reduced if all well known outing only or at least ``routing mostly'' nodes are reduced. Under these harsh assumptions the set may be reduced to the potential set of ``well known'' recipients of a message.
\fxfatal{Write something about degree of anonymity and how to achieve or compromise}

\subsection{Attacking Anonymity through Traffic Analysis}
As traffic and decoy traffic and decoy traffic are chosen by the creator of the routing block frequency patterns can not be detected, unlike the router did create them. Same applies to message sizes and traffic hotspots. 

\subsubsection{Attacking Anonymity through Timing Analysis}
\fxfatal{add more text here}

\subsubsection{Attacking Anonymity through Throughput Analysis}
\fxfatal{add more text here}

\subsection{Attacking Anonymity through Routing Block Analysis}
\fxfatal{add more text here}

\subsection{Attacking Anonymity through Header Analysis}
\fxfatal{add more text here}

\subsection{Attacking Anonymity through Payload Analysis}
\fxfatal{add more text here}

\subsection{Attacking Anonymity through Bugging}
\fxfatal{add more text here}

\subsection{Attacking Anonymity through Replay Analysis}
\fxfatal{add more text here}

\subsection{Attacking Anonymity through Tamper Replay Analysis}
\fxfatal{add more text here}

\chapter{Recommendations on Using the Vortex Protocol}
\fxfatal{add more text here}

\section{Reuse of Routing blocks}
\fxfatal{add more text here}

\section{Use of Ephemeral Identities}
\fxfatal{add more text here}

\section{Recommendations on Operations applied on Nodes}
\fxfatal{add more text here}

\section{Recommendations on Choosing involved Nodes}
\fxfatal{add more text here}

\chapter{Achieved Goals and Weaknesses}
Although the protocol was carefully designed it has certain flaws. These flaws typically assume that parts of the underlying security has been severely broken to be exploited.


\section{Message content}
Although it is possible to embed any type of content into a Vortex message great care should be taken as content may allow to disclose a readers identity or location. For this reason only self contained messages should be used (such as plain text messages).

\subsection{Splitting of message content}
\fxfatal{add more text here}

\subsection{Redundancy}
\fxfatal{add more text here}

\subsection{Redundancy Detection as Attack Pattern}
\fxfatal{add more text here}

\subsection{Routing Considerations}
\fxfatal{add more text here}

\subsection{Operaion Considerations}
\fxfatal{add more text here}

\subsection{Hotspot Avoidance}
\fxfatal{add more text here}


\chapter{Anonymity}
\fxfatal{add content here}

\subsection{Size of the Anonymity Set}
\fxfatal{add more text here}

\subsection{Jurisdictional implications onto the Anonymity Set}
\fxfatal{add more text here}

\section{Effects of anonymous communication on behaveour}
\fxfatal{\cite{postmes2001social}}

\fxfatal{add content}

