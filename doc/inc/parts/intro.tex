\chapter{Introduction}
This document describes a solution, which should offer anonymity against third parties when sending emails based on SMTP and the respective client protocols (e.g. IMAPv4 or POP3). This seemed to bother very few peoples up until information in Echelon became public due to an investigation by a commitee of the european parlament in 2001\cite{ECHELON}. Things settled again with local peaks up until a whistle blower named Edward Snowden disclosed $200\,000$ documents proofing activities of the NSA and other secret services. This led to the ``2013 mass surveillance disclosures'' and damaged the reputation of the american nation in many countries\cite{wiki:edward_snowden}.

\section{Overview over the current situation}
SMTP as defined in RFC5321\cite{RFC5321} is as of today (2013)  state of the art transmission protocol for electronic mail. It is standardized in its current version since 2008 and is one of the few protocols, which is marked as "Standard". While the protocol delivers reliable mail transfer between two endpoint (mail servers) the anonymity of the message content towards any mail server is not given (For a detailed analysis see chapter "`\nameref{chap:analysis}"').\par

Anonymity against third party is not given due to the following facts.

\begin{itemize}
  \item There is not always an encryption available between a mail user agent (MUA) and the outgoing mail server.
	\item There is no way to guarantee that a mail transfer between two SMTP hosts is encrypted.
	\item There is not always an encryption available between a SMTP host and the MUA of the recipient.
  \item Encryption based on top level protocols (such as S/MIME or PGP) do hide the message content. The sender, recipient, the subject and some technical information (eg. MIME-Headers) are always in plain available and not protected at all.
	\item Even if there is a reliable encryption between all endpoints and none of the intermediate servers are compromised sender and recipients might still be identified thru traffic analysis.
\end{itemize}

Keeping the message content confidential is more and more relevant in these days. The more the importance of mail transfer in today's economy is growing the more is confidentiality and reliability a topic. Unfortunately Secret Services have already discovered the significance of today's mail traffic and start to analyse those. With the presence of Secret Services in the internet, actively investigating data the importance of a reliable data channel for today's messages has become increasingly important. 

Quick wins such as the use of "Onion Router Networks" (such as TOR) do not offer any additional security since the message content would be revealed in full to an eventual exit node and any mail server on its way to the recipient.

\section{Problem statement}
This work is an approach to extend the existing mail routing based on SMTP by an intermediate layer, which should offer anonymity against third party.\par

This work delivers the following results:

\begin{itemize}
  \item A throughout analysis of current technology and its weaknesses.\par
	      Although the Simple Mail Transfer Protocol (SMTP) is a well-implement\-ed and well proven technology its weaknesses are well known. The SMTP protocol was originally defined in RFC821\cite{RFC821} by Johnathan B. Postel. At this time internet was only available to universities, some mayor companies and governments. The objective of Simple Mail Transfer Protocol (SMTP) is to transfer mail reliably and efficiently\cite[p.~1]{RFC821}. Confidentiality or having a tamper proof protocol was no design goal. Over the years many standards arose trying to close some of the gaps. Some of them are being used but most of them are not very common. 
	\item An analysis of possible approaches to improve the current standards.\par
	      Many standards and technologies do exist these days addressing parts of the issues mentioned above. A throughout research should be carried out to identify how can these technologies be combined to achieve the subsequent goals. Furthermore technology advanced. Namely in the field of cryptology few possibilities and ideas arose (such as new encryption classes [eg. elliptic curves] or the idea of crypto puzzles). Another field of research which emerged in the analysis of traffic flow is handled under the term ``Big Data'' where not single events but the sum of events is handled.
	\item A RFC document\par
	      It will describe an approach offering a significant quality improvement of the existing solutions, which could be accepted by the internet community.\par
	      The document has to follow the standards \citetitle{RFC2223} \cite{RFC2223}, \citetitle{RFC2119} \cite{RFC2119}, \citetitle{RFC3979} \cite{RFC3979} and \citetitle{RFC5378} \cite{RFC5378}. 
	\item A prototype reflecting at least the minimum baseline of the RFC document to reflect prove its functionality.\par
	      A prototype should be offered to show the feasibility. The Prototype should be a reference implementation and offer a quick way to use the new technology. It should be distributed under the LGPL license to simplify distribution of the technology. 
\end{itemize}

\section{Contributions}
This thesis contributes to the topic in the following senses:
\begin{itemize}
\item It introduces a consistent model for message delivery which includes all endpoints and involved parties.
\item It shows an approach based on existing protocols for anonymous communication which gives full control of the anonymity to the sender while controlling the costs.
\item It offers a client application implementing the proposed Protocol as IMAPv4 cache daemon and as SMTP relay.
\end{itemize}

\section{Notation}
\subsection{Cryptography}
The theory in this document is heavily based on symetric encryption, asymetric encryption and hashing. In order to use a uniformed notation I use $E^{K_a}(M)$ (where $a$ is an index to distinguish multiple keys) resulting in $M^{K_a}$ as the encrypted message. Messages encrypted with multiple keys do list the used keys as a coma separated list in superscript $E^{K_b}\left(E^{K_a}\left(M\right)\right)=M^{{K_{a}},{K_b}}$.\par

For a symetric encryption of a message $M$ with a key $K_a$ resulting in $G^{K_a}$ where $a$ is an index to distinguish different keys. Decryption uses therefore $D^{K_a}(M^{K_a})$.\par

As notation for asymetric encryption I use $E^{K^{1}_a}(M)$ where as $K^{-1}_a$ is the private key and $K^{1}_a$ is the public key of a key pair $K^p_a$. The asymetric decryption is noted as $D^{K^{-1}_a}(M)$.\par

For hashing I do use $H(M)$ if unsalted and $H^{S_a}$ if using a salted hash with salt $S_a$. The generated hash is shown as $H_M$ if unsalted and $H^{S_a}_M$ if salted.\par

\begin{align*}
asymetric: & E^{K^{-1}_a}\left(M\right) &~&=M^{K^{-1}_a}\\
           & D^{K^{1}_a}\left(E^{K^{-1}_a}\left(M\right)\right)&=D^{K^{-1}_a}\left(E^{K^{1}_a}\left(M\right)\right)&=M\\
symetric:  & E^{K_a}\left(M\right) &~&=M^{K_a}\\
           & D^{K_a}\left(E^{K_a}\left(M\right)\right)&~&=M\\
hashing (unsalted): & H\left(M\right)&~&=H_M\\
hashing (salted): & H^{S_a}\left(M\right)&~&=H^{S_a}_M
\end{align*}

\subsection{Code and commands}
Code blocks are always displayed as light grey block with line numbers:

\begin{lstlisting}
public class Hello {
	public static void main(String args[]) {
		System.println("Hello. "+args[1]);
	}
}
\end{lstlisting}

Commands entered at the command line are in a grey box with top and bottom line. Whenever root rights are required the command line is prefixed with a ``\#''. Commands not requiring specific rights are prefixed with a ``\textasciitilde''. Lines without a trailing ``\textasciitilde'' or ``\#'' are output lines of the previous command. If long lines have to be broken to fit into the paper a ``$\rhookswarrow$'' is inserted to indicate that the linebrake has been introduced for readability.

\begin{lstlisting}[style=BashInputStyle]
~ su -
# javac Hello.java 
# exit
\$ java Hello
Hello.
\$ java Hello "This is a very long command-line that had to be broken to fit into the code box displayed on this page."
Hello. This is a very long command-line that had to be broken to fit into the code box displayed on this page.
\end{lstlisting}

